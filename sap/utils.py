from common.parser import Parser
from common.json_writer import JSONWriter
from sap.row_parser import RowParser

def get_publish_date_string(parser):
    # table_bulletin_div = parser.get_tag_by_class("table parbase section")
    # rows = parser.get_table_body_rows(table_bulletin_div)
    return "14th of April 2020"

def get_outer_div(parser, div_class):
    div = parser.get_tag_by_class(div_class)
    return div 

def get_title(parser):
    title_soup = parser.get_tag_by_id("title-text")
    title = title_soup.a.text.strip()
    title = title.replace("\u00e2\u0080\u0093", "")
    return title

def get_security_alerts_json(vendor, url,div_class):
    parser = Parser(url)

    title = get_title(parser)
    outer_div = get_outer_div(parser, div_class)
    alerts = parser.get_table_body_rows(outer_div)
    # alerts = [alerts[19]]
    # alerts = [alerts[0],alerts[1],alerts[2],alerts[3], alerts[4], alerts[5], alerts[6]]
    # print(alerts)
    publisging_date = get_publish_date_string(parser)

    row_parser = RowParser(publisging_date)

    writer = JSONWriter(alerts, row_parser)
    json_alerts = writer.get_security_alerts_json(
        "vendor", vendor, url, None, title)
    return json_alerts