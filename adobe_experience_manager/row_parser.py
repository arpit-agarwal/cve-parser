from datetime import datetime
from common.row_parser import BaseRowParser
from common.utils import parse_cpes, get_publish_date

class RowParser(BaseRowParser):


    def __init__(self, publishing_date):
        super().__init__()
        self.publishing_date = None
        self.description = 0
        self.severity = 2
        self.cve = 3
        self.version = 4
        self.publishing_date = publishing_date

    def get_publish_date(self,cells):
        return get_publish_date(
                self.publishing_date,
                self.publishing__date_input_format)
    
    def get_cpes(self,cells, vendor, product):
        return parse_cpes(cells[self.version].text,
                                    vendor,
                                    product, self.parse_version, True)
    def get_cvssv2(self, cells):
        return {"severity": self.normalize_severity(cells[self.severity].text.strip()) }

    def get_cvssv3(self,cells):
        return self.get_cvssv2(cells)

    def parse_version(self,version_string):
        versions = version_string.strip('\n').split('\n')

        (start, end) = (versions[0], versions[-1])
        start = start[4:].strip()
        end = end[4:].strip()
        return (start, end, None)

    def normalize_severity(self, severity):
        if severity == "Important":
            return "HIGH"
        elif severity ==  "Moderate":
            return "MEDIUM"
        return "LOW"




