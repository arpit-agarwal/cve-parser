from datetime import datetime
from common.row_parser import BaseRowParser
from common.utils import parse_cpes, get_publish_date

class RowParser(BaseRowParser):

    PUBLISHING__DATE_INPUT_FORMAT = "%B %d, %Y"
    PUBLISHINGDATE = None
    PRODUCT = 1
    DESCRIPTION = 0
    VERSION = 4
    CVE = 3
    SEVERITY = 2

    def __init__(self, publishing_date):
        self.publishing_date = publishing_date

    def get_publish_date(self,cells):
        return get_publish_date(
                self.publishing_date,
                self.PUBLISHING__DATE_INPUT_FORMAT)
    
    def get_cpes(self,cells, vendor, product):
        return parse_cpes(cells[self.VERSION].text,
                                    vendor,
                                    product, self.parse_version, True)
    def get_cvssv2(self, cells):
        return {"severity": self.normalize_severity(cells[self.SEVERITY].text.strip()) }

    def get_cvssv3(self,cells):
        return self.get_cvssv2(cells)

    def parse_version(self,version_string):
        versions = version_string.strip('\n').split('\n')

        (start, end) = (versions[0], versions[-1])
        start = start[4:].strip()
        end = end[4:].strip()
        return (start, end, None)

    def normalize_severity(self, severity):
        if severity == "Important":
            return "HIGH"
        elif severity ==  "Moderate":
            return "MEDIUM"
        return "LOW"




