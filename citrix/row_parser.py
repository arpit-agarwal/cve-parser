from common.row_parser import BaseRowParser
from datetime import datetime
from bs4 import BeautifulSoup


class RowParser(BaseRowParser): 
    
    def __init__(self):
        self.timestamp_format = '%Y-%m-%dT%H:%MZ'
        self.publishing__date_input_format = "%a, %d %b %Y %H:%M:%S %Z"

    def get_cells(self,row):
        self.current_row = BeautifulSoup(row.description.text, 'html.parser') 
        return row

    def get_publish_date(self, row):
        return datetime.strptime(
                row.pubDate.text,
                self.publishing__date_input_format)

    def get_version_string(self, row):
        return "version"

    def get_product(self, row, vendor, product):
        return  row.find_all("category")

    def get_cve_id(self, row):
        heading = row.title.text
        if heading.startswith("CVE"):
            return heading.split()[0]
        return row.link.text.rsplit("/", 1)[1]

    def get_description(self, row):
        # print(self.current_row.prettify())
        return row.title.text

    def get_product_name(self, current_product_node):
        return current_product_node.text

    def get_cpe_list(self, vendor, product, category, cpes):
        tuples = list()
        i=0
        for current_product in product:
            current_product_tuple = self.get_cpe_list_per_product(vendor, self.get_product_name(current_product), category, cpes[i])
            tuples += current_product_tuple
            i =+ 1
        return tuples
    
    def get_cpe_list_per_product(self, vendor, product, category, cpes):
        cpes_list = cpes.split(",")
        return [(vendor, product, category, cpes_list)]






