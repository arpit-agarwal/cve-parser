from common.rss_feed_parser import RSSFeedParser
from common.json_writer import JSONWriter
from common.utils import dump_as_json
from citrix.row_parser import RowParser

def get_security_alerts_json(vendor, url, from_date_string, to_date_string):
    failed_cvs_count = 0

    parser = RSSFeedParser(url)
    title = parser.get_title()
    rows = parser.get_cve_rows()
    # rows = rows[46:50]

    row_parser = RowParser(from_date_string, to_date_string)
    writer = JSONWriter(rows, row_parser)
    (cves,failed_cvs_count_per_url, skipped_count_per_url) = writer.parse_alerts(
        vendor, url, None, title)
    return (dump_as_json(vendor,cves),len(cves), failed_cvs_count_per_url, skipped_count_per_url)

