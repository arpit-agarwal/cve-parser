from common.utils import parse_version as common_parse_version,parse_cpes
from common.row_parser import BaseRowParser

class RowParser(BaseRowParser):

    PUBLISHING__DATE_INPUT_FORMAT = "%B %d, %Y"
    PUBLISHINGDATE = 0
    PRODUCT = 1
    DESCRIPTION = 2
    VERSION = 3
    CVE = 5
    SEVERITY = None


    def parse_version(self,version_string):
        # for finding sw_edition from version string
        versions = common_parse_version(version_string)
        if versions is not None and versions != "Invalid":
            (start, end, sw_edition) = versions
            if not (start is None or start[0].isdigit()):
                parts = start.rsplit(" ", 1)
                start = parts[1]
                sw_edition = parts[0]
                return (start, end, sw_edition)

        return versions

    def get_cells(self,row):
        return row.find_all("p")
    
    def get_cpes(self,cells, vendor, product):
        return parse_cpes(cells[self.VERSION].text,
                                    vendor,
                                    product, self.parse_version)


