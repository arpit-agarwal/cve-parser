from common.utils  import dump_as_json
from common.html_parser import HTMLParser
from common.json_writer import JSONWriter
from mongo_db.row_parser import RowParser

def get_security_alerts_json(vendor, product, url,security_div_id):
    parser = HTMLParser(url)

    outer_div = parser.get_tag_by_id(security_div_id)
    alerts = parser.get_table_rows(outer_div)
    title = "MongoDB Alerts"
    row_parser = RowParser()

    writer = JSONWriter(alerts, row_parser)
    (cves,failed_cvs_count_per_url) = writer.parse_alerts(
        vendor, url, product, title)

    return (dump_as_json(vendor,cves),len(cves), failed_cvs_count_per_url)
